{"version":3,"file":"vue.js","sources":["../src/observer/arr.js","../src/observer/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组\r\n// 1. 获取原来的数组方法\r\nlet  oldArrayProtoMethods = Array.prototype\r\n\r\n// 2. 继承数组的方法\r\n    /**\r\n     * 使用Object.create() 方法创建一个新对象，并将这个新对象的原型设置为oldArrayProtoMethods\r\n     */\r\nexport let ArrayMethods = Object.create(oldArrayProtoMethods)\r\n\r\n// 3.劫持数组的方法\r\nlet methods = [\r\n    \"push\",\r\n    \"pop\",\r\n    \"unshift\",\r\n    \"shift\",\r\n    \"splice\"\r\n]\r\n\r\n// 通过遍历methods数组中的每个方法名，将对应的函数重新定义ArrayMethods\r\nmethods.forEach(item => {\r\n    ArrayMethods[item]  = function(...args){\r\n        console.log('劫持数组')\r\n        // 将方法内部的\"this\"指向当前的数组对象，并传入args作为参数\r\n            /**\r\n             * oldArrayProtoMethods[item]=arr.push(arr) \r\n             * 所以得需要绑定this\r\n             */\r\n       let result =  oldArrayProtoMethods[item].apply(this,args)\r\n       return result\r\n    }\r\n})","import { ArrayMethods } from \"./arr\"\r\n\r\nexport function observer(data) {\r\n    // console.log(data)\r\n    // TODO: (1) 对象的处理 vue2\r\n    // 判断\r\n    if( typeof data != 'object' || data === null){\r\n        return data\r\n    }\r\n    // 通过一个类进行劫持\r\n    return new Observer(data)\r\n\r\n}\r\n\r\nclass Observer{\r\n    constructor(value) {\r\n        console.log(value)\r\n        // 判断数据是数组还是对象\r\n        if(Array.isArray(value)){\r\n            // 处理数组\r\n            // 将value的原型指向ArrayMethods\r\n            value.__proto__ = ArrayMethods\r\n            // console.log(value)\r\n            // 如果你是数组对象\r\n            this.observerArray(value) // 数组对象劫持\r\n        }else {\r\n            // 处理对象\r\n            this.walk(value)  // 遍历\r\n        }\r\n       \r\n    }\r\n    walk(data) {  // { msg: 'hello' }\r\n        // 原始写法\r\n        // let keys = Object.keys(data)\r\n        // for(let i=0;i<keys.length;i++) {\r\n        //     // 对我们的每个属性进行劫持\r\n        //     let key = keys[i]\r\n        //     let value = data[key]\r\n        //     definedReactive(data,key,value)\r\n        // }\r\n\r\n        // Es6写法\r\n        for(let [key,value] of Object.entries(data)){\r\n            definedReactive(data,key,value)\r\n        }\r\n    }\r\n\r\n    observerArray(value){  // [{a:1}]\r\n         for(let i=0;i<value.length;i++) {\r\n            observer(value[i])\r\n         }\r\n    }\r\n\r\n}\r\n// 对 对象中的属性进行劫持\r\nfunction definedReactive(data,key,value) {\r\n    observer(value) // 深度代理\r\n    Object.defineProperty(data,key,{\r\n        // 获取的时候触发\r\n        get() {\r\n            // console.log('获取的时候触发')\r\n            return value  // 返回值\r\n        },\r\n        set(newValue) {\r\n            // console.log('设置的时候触发')\r\n            if(newValue === value) return value\r\n            observer(newValue)  // 如果用户设置的值是对象\r\n            value = newValue    \r\n        }\r\n    })\r\n}\r\n\r\n\r\n// vue2 object.defineProperty 缺点：对象中的一个属性  {a:1,b:2}\r\n\r\n// {a:{},list:[]}\r\n\r\n// 总结：1) 对象\r\n// 1、vue2 object.defineProperty 有缺点，只能对对象中的一个属性进行劫持 \r\n// 2、遍历{a:1,b:2,obj:{}}\r\n// 3、递归 get    set\r\n\r\n\r\n// 数组 {list: [1,2,3,4],arr:[{a:1}]}\r\n// 方法函数劫持，劫持数组方法 通过 arr.push()\r\n\r\n","import { observer } from \"./observer/index\"\r\n\r\nexport function initState(vm) {\r\n    let opts = vm.$options\r\n    // console.log(opts)\r\n    // 判断\r\n    if(opts.props){\r\n        initProps()\r\n    }\r\n    if(opts.data){\r\n        initData(vm)\r\n    }\r\n    if(opts.watch){\r\n        initWatch()\r\n    }\r\n    if(opts.computed){\r\n        initComputed()\r\n    }\r\n    if(opts.methods){\r\n        initMethods()\r\n    }\r\n\r\n    // 计算属性\r\n    function initComputed() {}\r\n    // 方法属性\r\n    function initMethods() {}\r\n    // Props属性\r\n    function initProps() {}\r\n    // watch方法\r\n    function initWatch() {}\r\n\r\n\r\n    // data属性  TODO: 对data初始化 \r\n    function initData(vm) {\r\n        // console.log('data初始化',vm) // 1. data可能是对象 2.对象可能是函数\r\n        let data = vm.$options.data\r\n        vm._data = typeof data === \"function\" ? data.call(vm):data // 注意 this指向问题\r\n        data = vm._data  \r\n        // 数据进行劫持\r\n        observer(data)\r\n    }\r\n\r\n    // data{}  (1) 对象 (2) 数组 {a:{b:1},list:[1,2,3],arr:[{}]}\r\n\r\n\r\n\r\n    \r\n}","import { initState } from \"./initState\"\r\n\r\n// 为 Vue.js 添加初始化 mixin\r\nexport function initMixin(Vue) {\r\n    // 将 _init 方法添加到 Vue.prototype 中\r\n    Vue.prototype._init = function(options) {\r\n        // console.log(options)\r\n\r\n        // 将当前实例赋值给 vm\r\n        let vm = this  \r\n        // 将传入的 options 对象赋值给实例的 $options 属性\r\n        vm.$options = options\r\n        // 初始化实例状态\r\n        initState(vm)\r\n    }\r\n}\r\n\r\n","import {initMixin} from './init'\r\n\r\nfunction Vue(options) {\r\n    // 初始化\r\n    this._init(options)\r\n\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","ArrayMethods","Object","create","methods","forEach","item","console","log","_len","arguments","length","args","_key","result","apply","observer","data","_typeof","Observer","value","_classCallCheck","isArray","__proto__","observerArray","walk","_createClass","key","_i","_Object$entries","entries","_Object$entries$_i","_slicedToArray","definedReactive","i","defineProperty","get","set","newValue","initState","vm","opts","$options","props","initData","watch","computed","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}