{"version":3,"file":"vue.js","sources":["../src/observer/arr.js","../src/observer/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组\n// 1. 获取原来的数组方法\nlet oldArrayProtoMethods = Array.prototype\n\n// 2. 继承数组的方法\n/**\n * 使用Object.create() 方法创建一个新对象，并将这个新对象的原型设置为oldArrayProtoMethods\n */\nexport let ArrayMethods = Object.create(oldArrayProtoMethods)\n\n// 3.劫持数组的方法\nlet methods = [\n    \"push\",\n    \"pop\",\n    \"unshift\",\n    \"shift\",\n    \"splice\"\n]\n\n// 通过遍历methods数组中的每个方法名，将对应的函数重新定义ArrayMethods\nmethods.forEach(item => {\n    ArrayMethods[item] = function (...args) {\n        console.log('劫持数组')\n        // 将方法内部的\"this\"指向当前的数组对象，并传入args作为参数\n        /**\n         * oldArrayProtoMethods[item]=arr.push(arr) \n         * 所以得需要绑定this\n         */\n        let result = oldArrayProtoMethods[item].apply(this, args)\n        console.log(args)   // [{b:6}]\n        // 问题： 数组追加对象的情况 arr arr.push({a:1})\n        let inserted\n        switch (item) {\n            case 'push':\n            case 'unshift':\n                inserted = args\n                break;\n            case 'splice': \n                inserted = args.splice(2)   // arr.splice(0,1,{b:6})  // 除去前面两种方法，所以传参数2\n                break;\n            \n        }\n        console.log(inserted)\n        \n        let ob = this.__ob__ \n        if(inserted){\n            ob.observerArray(inserted) // 对我们添加的对象进行劫持\n        }\n        return result\n    }\n})","import { ArrayMethods } from \"./arr\"\n\nexport function observer(data) {\n    // console.log(data)\n\n    // TODO: (1) 对象的处理 vue2\n    // 判断\n    if (typeof data != 'object' || data === null) {\n        return data\n    }\n    // 通过一个类进行劫持\n    return new Observer(data)\n\n}\n\nclass Observer {\n    constructor(value) {\n        // 给 data 定义一个属性\n        Object.defineProperty(value, \"__ob__\", {\n            enumerable: false,\n            value: this\n        })\n\n        // console.log(value)\n        // 判断数据是数组还是对象\n        if (Array.isArray(value)) {\n            // 处理数组\n            // 将value的原型指向ArrayMethods\n            value.__proto__ = ArrayMethods\n            // console.log(value)\n            // console.log(value)\n            // 如果你是数组对象\n            this.observerArray(value) // 数组对象劫持\n        } else {\n            // 处理对象\n            this.walk(value)  // 遍历\n        }\n\n    }\n    walk(data) {  // { msg: 'hello' }\n        // 原始写法\n        // let keys = Object.keys(data)\n        // for(let i=0;i<keys.length;i++) {\n        //     // 对我们的每个属性进行劫持\n        //     let key = keys[i]\n        //     let value = data[key]\n        //     definedReactive(data,key,value)\n        // }\n\n        // Es6写法\n        for (let [key, value] of Object.entries(data)) {\n            definedReactive(data, key, value)\n        }\n    }\n\n    observerArray(value) {  // [{a:1}]\n        for (let i = 0; i < value.length; i++) {\n            observer(value[i])\n        }\n    }\n\n}\n// 对 对象中的属性进行劫持\nfunction definedReactive(data, key, value) {\n    observer(value) // 深度代理\n    Object.defineProperty(data, key, {\n        // 获取的时候触发\n        get() {\n            // console.log('获取的时候触发')\n            return value  // 返回值\n        },\n        set(newValue) {\n            // console.log('设置的时候触发')\n            if (newValue === value) return value\n            observer(newValue)  // 如果用户设置的值是对象\n            value = newValue\n        }\n    })\n}\n\n\n// vue2 object.defineProperty 缺点：对象中的一个属性  {a:1,b:2}\n\n// {a:{},list:[]}\n\n// 总结：1) 对象\n// 1、vue2 object.defineProperty 有缺点，只能对对象中的一个属性进行劫持 \n// 2、遍历{a:1,b:2,obj:{}}\n// 3、递归 get    set\n\n\n// 数组 {list: [1,2,3,4],arr:[{a:1}]}\n// 方法函数劫持，劫持数组方法 通过 arr.push()\n\n","import { observer } from \"./observer/index\"\n\nexport function initState(vm) {\n    let opts = vm.$options\n    // console.log(opts)\n    // 判断\n    if(opts.props){\n        initProps()\n    }\n    if(opts.data){\n        initData(vm)\n    }\n    if(opts.watch){\n        initWatch()\n    }\n    if(opts.computed){\n        initComputed()\n    }\n    if(opts.methods){\n        initMethods()\n    }\n\n    // 计算属性\n    function initComputed() {}\n    // 方法属性\n    function initMethods() {}\n    // Props属性\n    function initProps() {}\n    // watch方法\n    function initWatch() {}\n\n\n    // data属性  TODO: 对data初始化 \n    function initData(vm) {\n        // console.log('data初始化',vm) // 1. data可能是对象 2.对象可能是函数\n        let data = vm.$options.data\n        vm._data = typeof data === \"function\" ? data.call(vm):data // 注意 this指向问题\n        data = vm._data  \n        // 数据进行劫持\n        // 将data 上的所有属性代理到实例上 vm {a:1,b:2}\n        \n        for(let key in data){\n            proxy(vm,\"_data\",key) \n        }\n        observer(data)\n    }\n\n    function proxy(vm,source,key) {\n        Object.defineProperty(vm,key,{\n            get() {\n                return vm[source][key]\n            },\n            set(newValue) {\n                vm[source][key] = newValue\n            }\n        })\n    }\n\n    // data{}  (1) 对象 (2) 数组 {a:{b:1},list:[1,2,3],arr:[{}]}\n\n\n\n    \n}","import { initState } from \"./initState\"\n\n// 为 Vue.js 添加初始化 mixin\nexport function initMixin(Vue) {\n    // 将 _init 方法添加到 Vue.prototype 中\n    Vue.prototype._init = function(options) {\n        console.log(options)\n\n        // 将当前实例赋值给 vm\n        let vm = this  \n        // 将传入的 options 对象赋值给实例的 $options 属性\n        vm.$options = options\n        // 初始化实例状态\n        initState(vm)\n    }\n}\n\n","import {initMixin} from './init'\n\nfunction Vue(options) {\n    // console.log(options)\n    // 初始化\n    this._init(options)\n\n}\n\ninitMixin(Vue)\n\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","ArrayMethods","Object","create","methods","forEach","item","console","log","_len","arguments","length","args","_key","result","apply","inserted","splice","ob","__ob__","observerArray","observer","data","_typeof","Observer","value","_classCallCheck","defineProperty","enumerable","isArray","__proto__","walk","_createClass","key","_i","_Object$entries","entries","_Object$entries$_i","_slicedToArray","definedReactive","i","get","set","newValue","initState","vm","opts","$options","props","initData","watch","computed","_data","call","proxy","source","initMixin","Vue","_init","options"],"mappings":"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"}